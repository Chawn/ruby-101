# บันทึกการสร้างโปรเจค: จากศูนย์จนเป็นเว็บรายรับ-รายจ่าย (Ruby on Rails)

ยินดีต้อนรับสู่โลกของ Ruby on Rails ครับ! เพื่อให้คุณเข้าใจว่า "ความมหัศจรรย์" ที่เกิดขึ้นเบื้องหลังมีขั้นตอนอย่างไร ผมได้สรุปทุกสเต็ปที่ผมทำให้คุณแบบละเอียด เพื่อให้คุณศึกษาตามและเข้าใจโครงสร้างของมันครับ

---

## 1. การเตรียมเครื่องมือ (Setup)

### ปัญหาที่เจอ
เครื่องของคุณมี Ruby ติดมากับ macOS อยู่แล้ว แต่เป็นเวอร์ชันเก่า (2.6) ซึ่งเก่าเกินไปสำหรับ Rails เวอร์ชันใหม่ (8.x)

### สิ่งที่ทำ
1.  **ติดตั้ง Ruby ใหม่**: ใช้ Homebrew (`brew install ruby`) เพื่อลงเวอร์ชันล่าสุด (3.4.x)
2.  **ตั้งค่า Path**: บอกให้ Terminal รู้จัก Ruby ตัวใหม่แทนตัวเก่า (`export PATH=...`)

---

## 2. เริ่มต้นสร้างโปรเจค (Initialize)

### คำสั่งที่ใช้
```bash
rails new . --database=sqlite3
```
*   `rails new .`: สร้างโปรเจคใหม่ในโฟลเดอร์ปัจจุบัน (`.`)
*   `--database=sqlite3`: เลือกใช้ฐานข้อมูลแบบไฟล์เดียว (SQLite) เพราะแลง่าย ไม่ต้องติดตั้งโปรแกรม Database Server แยก เหมาะสำหรับผู้เริ่มต้น

---

## 3. สร้างระบบสมาชิก (Authentication)

เราไม่อยากเขียนระบบ Login/Logout เองทั้งหมด เพราะมันซับซ้อนและเสี่ยงเรื่องความปลอดภัย ผมจึงเลือกใช้ **Gem (Library)** ยอดนิยมชื่อ **Devise**

### ขั้นตอน
1.  **เพิ่ม Devise**: สั่ง `bundle add devise` เพื่อโหลด Library เข้ามา
2.  **ติดตั้งลงโปรเจค**: สั่ง `rails g devise:install` เพื่อสร้างไฟล์ตั้งค่าพื้นฐาน
3.  **สร้างโมเดล User**: สั่ง `rails g devise User`
    *   คำสั่งนี้สร้างตาราง `users` ในฐานข้อมูล พร้อมระบุว่าต้องมี email, password (ที่เข้ารหัสแล้ว), และอื่นๆ

---

## 4. สร้างฟีเจอร์ "บันทึกรายรับ-รายจ่าย" (Scaffold)

นี่คือท่าไม้ตายของ Rails ครับ เรียกว่า **Scaffold** (นั่งร้าน) มันคือการสั่งทีเดียว ได้ครบทั้ง "หลังบ้าน" และ "หน้าบ้าน"

### คำสั่งที่ใช้
```bash
rails generate scaffold Transaction title:string amount:decimal kind:string date:date user:references
```

### แปลความหมาย
*   **Transaction**: ชื่อโมเดล (รายการธุรกรรม)
*   **title:string**: เก็บชื่อรายการ เป็นข้อความ
*   **amount:decimal**: เก็บจำนวนเงิน เป็นตัวเลขทศนิยม
*   **kind:string**: เก็บประเภท (รายรับ/รายจ่าย)
*   **date:date**: เก็บวันที่
*   **user:references**: **สำคัญมาก!** บอกว่ารายการนี้ "เป็นของใคร" (ผูกกับตาราง User)

### สิ่งที่ Rails สร้างให้
*   **Model**: ไฟล์สำหรับคุยกับ Database
*   **Controller**: ไฟล์สำหรับจัดการ Logic (รับค่าจากฟอร์ม, บันทึก, ลบ)
*   **Views**: หน้าเว็บ HTML 4 หน้า (List, Show, New/Edit)
*   **Migration**: ไฟล์สำหรับสร้างตารางใน Database

หลังจากสร้างไฟล์โค้ดเสร็จ ต้องสั่ง `rails db:migrate` เพื่อให้มันไปสร้างตารางใน Database จริงๆ

---

## 5. เชื่อมโยงข้อมูลและจำกัดสิทธิ์ (Association & Authorization)

Scaffold สร้างของมาให้ครบ "แต่" มันยังอนุญาตให้ทุกคนเห็นข้อมูลของทุกคนได้ ผมเลยต้องแก้โค้ดเพิ่มอีกนิดหน่อย:

### 5.1 ผูกสัมพันธ์ (Models)
ในไฟล์ `app/models/user.rb` ผมเพิ่ม:
```ruby
has_many :transactions
```
แปลว่า: "User หนึ่งคน มีรายการธุรกรรมได้หลายรายการ"

### 5.2 จำกัดสิทธิ์ (Controller)
ในไฟล์ `app/controllers/transactions_controller.rb` ผมแก้ 2 จุดสำคัญ:

1.  **บังคับ Login**:
    ```ruby
    before_action :authenticate_user!
    ```
    แปลว่า: "ใครจะเข้าหน้านี้ ต้อง Login ก่อนนะ ถ้ายังไม่ Login ให้เด้งไปหน้า Sign in"

2.  **ดูได้แค่ของตัวเอง**:
    *   จากเดิม: `Transaction.all` (ดึงมาทั้งหมดในโลก)
    *   แก้เป็น: `current_user.transactions` (ดึงมาเฉพาะของคนที่ Login อยู่)
    *   ตอนสร้างก็เช่นกัน: ใช้ `current_user.transactions.new(...)` เพื่อให้เวลากด Save แล้ว มันจะแปะชื่อเจ้าของรายการให้อัตโนมัติ

---

## 6. ติดตั้ง Tailwind CSS (Styling)

เพื่อให้หน้าเว็บสวยงาม ผมได้ติดตั้ง **Tailwind CSS** เพิ่มเติมครับ

### สิ่งที่ทำ
1.  **ติดตั้ง Gem**: `bundle add tailwindcss-rails`
2.  **Run Install**: `bin/rails tailwindcss:install`
    *   คำสั่งนี้เตรียมไฟล์ CSS พื้นฐานและตั้งค่าให้ Rails รู้จัก Tailwind

---

## สรุป
สิ่งที่คุณได้ตอนนี้คือ Web Application ที่สมบูรณ์แบบในระดับพื้นฐาน:
1.  สมัครสมาชิก/Login ได้
2.  บันทึกข้อมูลส่วนตัวแยกกันได้
3.  มีหน้าจอให้กดเล่นครบ (เพิ่ม/ลบ/แก้ไข)
4.  รองรับการแต่งหน้าจอด้วย Tailwind CSS

ลองแกะโค้ดดูตามไฟล์ที่ผมพูดถึงนะครับ จะช่วยให้เข้าใจ Rails ได้ไวขึ้นมาก!
